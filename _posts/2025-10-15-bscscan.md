---
layout: post
title: 'Pythonå®ç°ç›‘æ§BSCé“¾ä¸ŠFOURå¹³å°å‘å°„çš„ä»£å¸'
subtitle: 'Pythonçš„web3åº“çš„ç®€å•æ¡ˆä¾‹'
date: 2025-10-15
categories: Web3
tags:  
- web3
- åŠ å¯†è´§å¸
---

## ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ª
* Pythonçš„web3åº“çš„ç»ƒä¹ 
* æœ€è¿‘BSCçš„MEMEå¾ˆç«ï¼Œå†™è¿™ä¸ªå·¥å…·ç©ä¸€ç©

## å·¥å…·å‡†å¤‡
* Python
* [Etherscanå®˜ç½‘æ³¨å†Œè·å–å…è´¹API](https://etherscan.io/apis)

## è®¾è®¡æ€è·¯
* åœ¨[BSCæµè§ˆå™¨](https://bscscan.com/)é‡ŒæŸ¥çœ‹[FOUR](https://four.meme/zh-TW)å¹³å°å‘å°„å‡ºæ¥çš„ä»£å¸ï¼Œå‘ç°å…¶ä»£å¸çš„æ™ºèƒ½åˆçº¦æ˜¯é€šè¿‡å·¥å‚æ¨¡å¼åˆ›å»ºçš„ã€‚
![](../assets/img/posts/2025-10-15-bscscan/image.png)

* å¾ˆå®¹æ˜“æ‰¾åˆ°FOURçš„å·¥å‚åˆçº¦åœ°å€ï¼š `0x5c952063c7fc8610FFDB798152D69F0B9550762b`
![](../assets/img/posts/2025-10-15-bscscan/image-2.png)

* æŸ¥çœ‹è¿™æ¡å“ˆå¸Œï¼Œç„¶ååœ¨ `Internal Txns` å†…éƒ¨äº¤æ˜“ä¸­æ‰¾åˆ°CREATEæ–¹æ³•çš„è°ƒç”¨ï¼Œå°±è¯´æ˜è¿™ç¬”äº¤æ˜“åˆ›å»ºäº†ä¸€ä¸ªæ–°ä»£å¸ï¼Œåœ¨äº¤æ˜“çš„ `To` å€¼é‡Œï¼Œæ‰¾åˆ°æ–°ä»£å¸çš„åˆçº¦åœ°å€ã€‚
![](../assets/img/posts/2025-10-15-bscscan/image-1.png)

* æ‰€ä»¥ä»£ç çš„æ‰§è¡Œæ€è·¯ï¼š

1.è½®è¯¢BSCçš„åŒºå—ï¼Œæ‰¾åˆ° `To` æ˜¯FOURå·¥å‚åˆçº¦çš„å“ˆå¸Œã€‚

2.æå–æ¯ä¸ªå“ˆå¸Œé‡Œçš„ `Internal Txns` äº¤æ˜“ï¼Œå¦‚æœé‡Œé¢æœ‰CREATEæ–¹æ³•çš„è°ƒç”¨ï¼Œé‚£ä¹ˆè¿™æ¬¡äº¤æ˜“åˆ™åˆ›å»ºäº†ä¸€ä¸ªæ–°ä»£å¸ï¼Œä»£å¸çš„åˆçº¦åœ°å€å°±æ˜¯ `To` çš„åœ°å€ã€‚

3.è°ƒç”¨ä»£å¸åˆçº¦çš„æ–¹æ³•ï¼Œè·å¾—ä»£å¸çš„åç§°ã€‚

## ä»£ç å®ç°

è½®è¯¢åŒºå—ï¼Œæ‰¾åˆ° `To` ä¸ºå·¥å‚åˆçº¦çš„å“ˆå¸Œ

```python
for tx in block['transactions']:
    if tx['to'] and tx['to'] == FACTORY_ADDRESS:
        txStr = '0x' + str(tx['hash'].hex())
        print(f"æ£€æŸ¥äº¤æ˜“:{txStr}")
        new_addrs, error = v2_internal_txns(txStr)
```

æ£€æŸ¥å“ˆå¸Œçš„ `Internal Txns` é‡Œæ˜¯å¦æœ‰CREATEçš„å‡½æ•°è°ƒç”¨ï¼Œå¦‚æœæœ‰ï¼Œè·å– `To` çš„åˆçº¦å³ä¸ºæ–°ä»£å¸åˆçº¦åœ°å€

```python
def v2_internal_txns(tx_hash, use_batch=False):
    """ä½¿ç”¨Etherscan V2 APIè·å–Internal TXNsï¼ˆchainid=56ï¼‰"""
    url = "https://api.etherscan.io/v2/api"  # V2ç»Ÿä¸€ç«¯ç‚¹
    ...
    else:
        # å•tx
        params = {
            'chainid': 56,
            'module': 'account',
            'action': 'txlistinternal',
            'txhash': tx_hash,
            'apikey': ETHERSCAN_API_KEY
        }
    
    try:
        response = requests.get(url, params=params)
        print(f"DEBUG: V2 URL: {url}, çŠ¶æ€ç : {response.status_code}")
        print(f"DEBUG: å“åº”å†…å®¹: {response.text[:300]}...")  # æˆªæ–­è°ƒè¯•
        
        if response.status_code != 200:
            return [], f"HTTP {response.status_code}: {response.text}"
        
        data = response.json()
        if data.get('status') == '1' and 'result' in data:
            new_addresses = []
            for txn in data['result']:
                contractAddr = txn.get('contractAddress', '')  # e.g., "create2_0_1_1_1"
                txn_type = txn.get('type', '').lower()
                to_addr = txn.get('to', '')
                if txn_type == 'create2' and to_addr == '' and contractAddr:
                    new_addresses.append(Web3.to_checksum_address(contractAddr))
            return new_addresses, None
        else:
            return [], f"APIé”™è¯¯: {data.get('message', 'æœªçŸ¥')}"
    except json.JSONDecodeError as e:
        return [], f"JSONè§£æå¤±è´¥ (å¯èƒ½æ˜¯404/éJSON): {response.text[:100]} - {str(e)}"
    except Exception as e:
        return [], f"V2 APIè°ƒç”¨å¤±è´¥: {str(e)}"
```

æ£€æŸ¥ä»£å¸çš„åˆçº¦åœ°å€ï¼Œè·å–ä»£å¸çš„åå­—
```python
def is_bep20_token(contract_address):
    """éªŒè¯BEP-20ä»£å¸"""
    try:
        if w3.eth.get_code(contract_address) == '0x':
            return False, "éåˆçº¦åœ°å€"
        contract = w3.eth.contract(address=contract_address, abi=BEP20_ABI)
        name = contract.functions.name().call()
        symbol = contract.functions.symbol().call()
        return True, f"{symbol} ({name})"
    except Exception as e:
        return False, f"éBEP-20æˆ–è°ƒç”¨å¤±è´¥: {str(e)}"
```

å®Œæ•´ä»£ç å¦‚ä¸‹ï¼Œå…¶ä¸­`ETHERSCAN_API_KEY`éœ€è¦æ›´æ¢æˆè‡ªå·±çš„API Keyï¼Œå»è¿™é‡Œæ³¨å†Œ[Etherscanå®˜ç½‘æ³¨å†Œè·å–å…è´¹API](https://etherscan.io/apis)

```python
from web3 import Web3
from web3.middleware import ExtraDataToPOAMiddleware
import time
import json
import requests
from hexbytes import HexBytes

# BSC RPCï¼ˆæµ‹è¯•debug_traceæ”¯æŒï¼›è‹¥å¤±è´¥ï¼Œæ¢Ankr: https://rpc.ankr.com/bscï¼‰
RPC_URL = 'https://bsc-dataseed1.binance.org/'  # æˆ– 'https://bsc.rpc.blxrbdn.com/' æ”¯æŒtrace
w3 = Web3(Web3.HTTPProvider(RPC_URL))

# æ·»åŠ POAä¸­é—´ä»¶,å› ä¸ºBSCæœ‰ä¸€éƒ¨åˆ†POAç½‘ç»œè¡€ç»Ÿ,éœ€è¦æ·»åŠ POAä¸­é—´ä»¶
w3.middleware_onion.inject(ExtraDataToPOAMiddleware, layer=0) 

# BEP-20éªŒè¯ABI
BEP20_ABI = [
    {"constant": True, "inputs": [], "name": "name", "outputs": [{"name": "", "type": "string"}], "type": "function"},
    {"constant": True, "inputs": [], "name": "symbol", "outputs": [{"name": "", "type": "string"}], "type": "function"}
]

# FORMå·¥å‚åœ°å€
FACTORY_ADDRESS = '0x5c952063c7fc8610FFDB798152D69F0B9550762b'

# Etherscan/BscScan V2 API Keyï¼ˆå…è´¹ï¼šhttps://etherscan.io/myapikey æˆ– bscscan.com/myapikeyï¼‰
ETHERSCAN_API_KEY = ''  # å…±äº«key

# BEP-20éªŒè¯ABI
BEP20_ABI = [
    {"constant": True, "inputs": [], "name": "name", "outputs": [{"name": "", "type": "string"}], "type": "function"},
    {"constant": True, "inputs": [], "name": "symbol", "outputs": [{"name": "", "type": "string"}], "type": "function"}
]

def is_bep20_token(contract_address):
    """éªŒè¯BEP-20ä»£å¸"""
    try:
        if w3.eth.get_code(contract_address) == '0x':
            return False, "éåˆçº¦åœ°å€"
        contract = w3.eth.contract(address=contract_address, abi=BEP20_ABI)
        name = contract.functions.name().call()
        symbol = contract.functions.symbol().call()
        return True, f"{symbol} ({name})"
    except Exception as e:
        return False, f"éBEP-20æˆ–è°ƒç”¨å¤±è´¥: {str(e)}"

def v2_internal_txns(tx_hash, use_batch=False):
    """ä½¿ç”¨Etherscan V2 APIè·å–Internal TXNsï¼ˆchainid=56ï¼‰"""
    url = "https://api.etherscan.io/v2/api"  # V2ç»Ÿä¸€ç«¯ç‚¹
    if use_batch:
        # æ‰¹é‡ï¼šç”¨address + åŒºå—èŒƒå›´ï¼ˆæ›´é«˜æ•ˆï¼Œé¿å…å•tx 404ï¼‰
        params = {
            'chainid': 56,  # BSC
            'module': 'account',
            'action': 'txlistinternal',
            'address': FACTORY_ADDRESS,  # å·¥å‚åœ°å€
            'startblock': '0',
            'endblock': 'latest',  # æˆ–æŒ‡å®šrecent block
            'page': 1,
            'offset': 10,  # æœ€è¿‘10ç¬”
            'sort': 'desc',
            'apikey': ETHERSCAN_API_KEY
        }
    else:
        # å•tx
        params = {
            'chainid': 56,
            'module': 'account',
            'action': 'txlistinternal',
            'txhash': tx_hash,
            'apikey': ETHERSCAN_API_KEY
        }
    
    try:
        response = requests.get(url, params=params)
        print(f"DEBUG: V2 URL: {url}, çŠ¶æ€ç : {response.status_code}")
        print(f"DEBUG: å“åº”å†…å®¹: {response.text[:300]}...")  # æˆªæ–­è°ƒè¯•
        
        if response.status_code != 200:
            return [], f"HTTP {response.status_code}: {response.text}"
        
        data = response.json()
        if data.get('status') == '1' and 'result' in data:
            new_addresses = []
            for txn in data['result']:
                contractAddr = txn.get('contractAddress', '')  # e.g., "create2_0_1_1_1"
                txn_type = txn.get('type', '').lower()
                to_addr = txn.get('to', '')
                if txn_type == 'create2' and to_addr == '' and contractAddr:
                    new_addresses.append(Web3.to_checksum_address(contractAddr))
            return new_addresses, None
        else:
            return [], f"APIé”™è¯¯: {data.get('message', 'æœªçŸ¥')}"
    except json.JSONDecodeError as e:
        return [], f"JSONè§£æå¤±è´¥ (å¯èƒ½æ˜¯404/éJSON): {response.text[:100]} - {str(e)}"
    except Exception as e:
        return [], f"V2 APIè°ƒç”¨å¤±è´¥: {str(e)}"

# æ­¤åŠŸèƒ½å®ç°æœ‰é—®é¢˜ï¼Œæš‚æ—¶ä¸ç”¨
def methodCheck(tx):
    """æ£€æŸ¥äº¤æ˜“æ˜¯å¦ä¸ºCREATE2"""
    try:
        input_data = tx.get('input','0x')
        if input_data == '0x' or len(input_data) < 10:
            return False
        
        method_id = '0x' + (input_data).hex()
        if '519ebb10' not in method_id:
            return False

        return True
    except Exception as e:
        print(f"æ–¹æ³•æ£€æŸ¥å¤±è´¥: {str(e)}")
        return False

def monitor_factory_create2(last_block='latest'):
    """ç›‘æ§å·¥å‚äº¤æ˜“ï¼Œä½¿ç”¨V2 APIæ£€æµ‹CREATE2"""
    last_block_num = w3.eth.block_number if last_block == 'latest' else int(last_block)
    current_block = last_block_num
    while True:
        if current_block > last_block_num:
            print(f"æ£€æµ‹åˆ°æ–°åŒºå—: {current_block}")
            block = w3.eth.get_block(current_block, full_transactions=True)
            
            for tx in block['transactions']:
                if tx['to'] and tx['to'] == FACTORY_ADDRESS:
                    txStr = '0x' + str(tx['hash'].hex())
                    print(f"æ£€æŸ¥äº¤æ˜“:{txStr}")
                    new_addrs, error = v2_internal_txns(txStr)

                    if error:
                        #print(f"V2å•txå¤±è´¥: {error}")
                        continue
                    # å¤„ç†new_addrs...
                    for addr in new_addrs:
                        is_token, details = is_bep20_token(addr)
                        if is_token:
                            print(f"ğŸš€ FORM CREATE2æ–°ä»£å¸: {addr}")
                            print(f"   è¯¦æƒ…: {details}")
                            print(f"   äº¤æ˜“å“ˆå¸Œ: {tx['hash'].hex()}")
                            print(f"   åŒºå—: {current_block}")
                            print("-" * 50)
            
            last_block_num = current_block
        current_block = last_block_num + 1
        time.sleep(3)  # è½®è¯¢é—´éš”

if __name__ == "__main__":
    if not w3.is_connected():
        print("âŒ æ— æ³•è¿æ¥BSC")
    else:
        print(f"âœ… å¼€å§‹ç›‘æ§FORMå·¥å‚ {FACTORY_ADDRESS} çš„CREATE2éƒ¨ç½²ï¼ˆEtherscan V2 + chainid=56ï¼‰...")
        monitor_factory_create2()
```

## åç»­ä¼˜åŒ–
* è¿™ä¸ªç¨‹åºä»…ä»…åªèƒ½åŸºæœ¬å®ç°æ‰¾åˆ°æ–°ä»£å¸çš„åŠŸèƒ½ï¼Œå’ŒDEXä¸Šçš„é‚£äº›æ‰«é“¾åŠŸèƒ½å®Œå…¨ä¸èƒ½æ¯”ï¼ŒDEXåŸºæœ¬ä¸Šéƒ½æ˜¯å’ŒFOURå¹³å°åˆä½œçš„ï¼Œåº”è¯¥æœ‰å¹³å°æä¾›çš„ä¸“ç”¨APIï¼Œæˆ‘è¿™é‡Œæ˜¯ä¸ºäº†å­¦ä¹ Web3ï¼Œä½¿ç”¨çš„éƒ½æ˜¯å…è´¹çš„å…¬å…±çš„èŠ‚ç‚¹å’ŒAPIã€‚

* æˆ‘åœ¨BscScané‡Œçœ‹åˆ°æ¯æ¡å“ˆå¸Œéƒ½æœ‰ä¸€ä¸ª`Method`å­—æ®µï¼Œåœ¨æµè§ˆå™¨é‡Œå¯ä»¥çœ‹åˆ°`CreateToken`çš„æ–¹æ³•ã€‚æ‰€ä»¥æˆ‘æƒ³åœ¨è½®è¯¢å·¥å‚åˆçº¦çš„å“ˆå¸Œæ—¶ï¼Œå…ˆå°†CreateTokençš„æ–¹æ³•çš„å“ˆå¸Œåˆ†ç¦»å‡ºæ¥ï¼Œå†å¯¹è¿™äº›å“ˆå¸Œè¿›è¡Œæå–æ“ä½œï¼Œå¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚
ä½†æ˜¯å°è¯•äº†ä¸€ä¸‹ï¼Œæš‚æ—¶æ²¡æœ‰æ‰¾åˆ°ä»£ç é‡Œè¾¨åˆ«Methodçš„æ–¹æ³•ï¼Œè‚¯å®šæ˜¯å¯ä»¥åšåˆ°çš„ï¼Œåªä¸è¿‡éœ€è¦æ—¶é—´å»æµ‹è¯•ï¼Œåç»­å¯ä»¥ä¼˜åŒ–è¿™ä¸€ç‚¹ã€‚

![](../assets/img/posts/2025-10-15-bscscan/image-3.png)

* å…¬å…±çš„BSCèŠ‚ç‚¹å¾ˆæ…¢ï¼Œç„¶åEtherscan APIçš„å…è´¹å¥—é¤ä¹Ÿå¯¹æ¯å¤©çš„è¯·æ±‚æ•°é‡å’Œé€Ÿåº¦æœ‰é™åˆ¶ï¼Œå¦‚æœæœ‰é’±çš„è¯ï¼Œå¯ä»¥ä¹°æ›´å¥½çš„å¥—é¤ï¼Œè¿˜ä¼šæœ‰æ›´æ–¹ä¾¿çš„APIå¯ä»¥ä½¿ç”¨ã€‚
